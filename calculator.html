<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>iPhone Calculator — Single File Clone</title>
<style>
  :root{
    --bg:#0b0b0f; --panel:#0f1720; --display:#0b1220; --btn-dark:#2b2f36; --btn-light:#e6e7ea; --accent:#ff9f0a; --muted:#98a0ad;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#04060a,#071226);display:flex;align-items:center;justify-content:center;color:#fff}
  .calc-wrap{width:360px;max-width:96vw;padding:18px;border-radius:28px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 20px 50px rgba(2,6,23,0.6)}
  .screen{background:var(--display);padding:18px;border-radius:18px;box-shadow:inset 0 -6px 20px rgba(0,0,0,0.5);text-align:right}
  .history{font-size:14px;color:var(--muted);min-height:20px;opacity:0.9}
  .result{font-size:56px;font-weight:600;line-height:1;margin-top:6px;word-break:break-all}
  .kbd{margin-top:14px;display:grid;grid-template-columns:repeat(4,1fr);gap:10px}

  button.btn{border:0;padding:18px;border-radius:12px;font-size:20px;cursor:pointer;user-select:none;box-shadow:0 6px 12px rgba(2,6,23,0.6);}
  button.btn:active{transform:translateY(1px)}
  .btn.func{background:var(--btn-dark);color:var(--btn-light)}
  .btn.op{background:linear-gradient(180deg,#ffb84d,#ff8b2b);color:#111;font-weight:700}
  .btn.num{background:linear-gradient(180deg,#2b2f36,#232528);color:var(--btn-light)}
  .btn.zero{grid-column:span 2;border-radius:14px}

  /* small responsive tweaks */
  @media (max-width:400px){.result{font-size:44px}}
</style>
</head>
<body>
  <div class="calc-wrap" role="application" aria-label="iPhone calculator clone">
    <div class="screen" aria-hidden="false">
      <div class="history" id="history"></div>
      <div class="result" id="display">0</div>
    </div>
    <div class="kbd" role="group" aria-label="calculator keypad">
      <button class="btn func" data-action="clear" id="btn-clear">AC</button>
      <button class="btn func" data-action="plusminus">±</button>
      <button class="btn func" data-action="percent">%</button>
      <button class="btn op" data-action="/">÷</button>

      <button class="btn num" data-num="7">7</button>
      <button class="btn num" data-num="8">8</button>
      <button class="btn num" data-num="9">9</button>
      <button class="btn op" data-action="*">×</button>

      <button class="btn num" data-num="4">4</button>
      <button class="btn num" data-num="5">5</button>
      <button class="btn num" data-num="6">6</button>
      <button class="btn op" data-action="-">−</button>

      <button class="btn num" data-num="1">1</button>
      <button class="btn num" data-num="2">2</button>
      <button class="btn num" data-num="3">3</button>
      <button class="btn op" data-action="+">+</button>

      <button class="btn num zero" data-num="0">0</button>
      <button class="btn num" data-num=".">.</button>
      <button class="btn op" data-action="=">=</button>
    </div>
  </div>
<script>
(function(){
  // State
  let display = document.getElementById('display');
  let history = document.getElementById('history');

  let current = '0'; // as string
  let previous = null; // stored number
  let operator = null; // '+', '-', '*', '/'
  let waitingForNew = false; // whether next number should replace display

  const maxDigits = 12;

  function updateDisplay(){
    // limit length but keep scientific if too long
    if(current.length > 16){
      // convert to number and format
      const n = Number(current);
      display.textContent = Number.isFinite(n) ? n.toExponential(9) : 'Error';
    } else {
      display.textContent = current;
    }
  }

  function inputDigit(d){
    if(waitingForNew){
      current = (d === '.') ? '0.' : d;
      waitingForNew = false;
    } else {
      if(d === '.' && current.includes('.')) return;
      if(current === '0' && d !== '.') current = d; else current = current + d;
    }
    // trim leading zeros
    if(current.length > 1 && current[0] === '0' && current[1] !== '.'){
      current = current.replace(/^0+/, '') || '0';
    }
    // prevent extremely long
    if(current.replace('.', '').length > 18) {
      current = current.slice(0,18);
    }
    updateDisplay();
    updateClearLabel();
  }

  function updateClearLabel(){
    const clearBtn = document.getElementById('btn-clear');
    clearBtn.textContent = (current !== '0' || previous !== null) ? 'C' : 'AC';
  }

  function clearAll(){ current = '0'; previous = null; operator = null; waitingForNew = false; history.textContent=''; updateDisplay(); updateClearLabel(); }

  function toggleSign(){
    if(current === '0') return;
    if(current.startsWith('-')) current = current.slice(1); else current = '-' + current;
    updateDisplay();
  }

  function percent(){
    const n = Number(current);
    current = String(n / 100);
    trimFloat();
    updateDisplay();
  }

  function performOperation(nextOp){
    const inputValue = Number(current);
    if(previous === null){
      previous = inputValue;
    } else if(operator){
      // compute previous operator
      const result = compute(previous, inputValue, operator);
      previous = result;
      current = String(result);
      trimFloat();
      updateDisplay();
    }
    operator = nextOp === '=' ? null : nextOp;
    waitingForNew = true;
    // update history
    history.textContent = previous !== null ? `${formatNumber(previous)} ${operator || ''}`.trim() : '';
  }

  function compute(a,b,op){
    let res = 0;
    switch(op){
      case '+': res = a + b; break;
      case '-': res = a - b; break;
      case '*': res = a * b; break;
      case '/': res = b === 0 ? NaN : a / b; break;
      default: res = b; break;
    }
    // avoid floating point artifacts
    return roundToSignificant(res, 12);
  }

  function roundToSignificant(x, sig){
    if(!isFinite(x)) return x;
    if(x === 0) return 0;
    const mult = Math.pow(10, sig - Math.ceil(Math.log10(Math.abs(x))));
    return Math.round(x * mult) / mult;
  }

  function trimFloat(){
    // remove trailing zeros
    if(current.includes('.')){
      current = current.replace(/(?:\.\d*?)(0+)$/,'').replace(/\.$/,'');
    }
  }

  function formatNumber(n){
    if(!isFinite(n)) return 'Error';
    const s = String(n);
    if(s.length <= 12) return s;
    return Number(n).toPrecision(12).replace(/(?:\.0+|(?<=\.[0-9]*?)0+)$/,'');
  }

  // Button handling
  document.querySelectorAll('button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const num = btn.dataset.num;
      const action = btn.dataset.action;
      if(typeof num !== 'undefined'){
        inputDigit(num);
      } else if(action){
        switch(action){
          case 'clear':
            if(btn.textContent === 'AC') clearAll(); else { current = '0'; updateDisplay(); updateClearLabel(); }
            break;
          case 'plusminus': toggleSign(); break;
          case 'percent': percent(); break;
          case '+': case '-': case '*': case '/': performOperation(action); break;
          case '=': performOperation('='); break;
        }
      }
    });
  });

  // Keyboard support
  window.addEventListener('keydown', (e)=>{
    const key = e.key;
    if((/^[0-9]$/.test(key))){ inputDigit(key); e.preventDefault(); }
    if(key === '.') inputDigit('.');
    if(key === 'Enter' || key === '=') { performOperation('='); e.preventDefault(); }
    if(key === '+') performOperation('+');
    if(key === '-') performOperation('-');
    if(key === '*' || key === 'x') performOperation('*');
    if(key === '/') performOperation('/');
    if(key === 'Backspace'){
      if(current.length > 1){ current = current.slice(0,-1); } else { current = '0'; }
      updateDisplay(); updateClearLabel();
    }
    if(key.toLowerCase() === 'c') clearAll();
  });

  // init
  updateDisplay(); updateClearLabel();
})();
</script>
</body>
</html>
